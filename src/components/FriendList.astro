---
import { getCollection } from 'astro:content'

const friends = await getCollection('friends')
---

<ul id="friend-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-8">
  {
    friends.map((friend) => (
      <li>
        <a href={friend.data.link} target="_blank" rel="noopener noreferrer external">
          <div class="px-6 py-4 flex gap-2 bg-accent/10 rounded-full group">
            <img
              class="shrink-0 size-16 object-contain rounded-full"
              src={friend.data.avatar}
              alt={`Friend avatar: ${friend.data.title}`}
              loading="lazy"
            />
            <div class="min-w-0 grow">
              <div class="truncate font-bold text-lg group-hover:text-accent">
                {friend.data.title}
              </div>
              <div class="text-sm line-clamp-2">{friend.data.description}</div>
            </div>
            <i class="shrink-0 iconfont icon-external-link group-hover:text-accent" />
          </div>
        </a>
      </li>
    ))
  }
</ul>
<div class="text-xs italic">（顺序为随机生成）</div>

<script>
  function shuffleFriends() {
    const list = document.getElementById('friend-list')
    if (!list) return

    const items = Array.from(list.children)
    if (items.length <= 1) return

    for (let i = items.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1))
      ;[items[i], items[j]] = [items[j], items[i]]
    }

    items.forEach((item) => list.appendChild(item))
  }

  shuffleFriends()

  document.addEventListener('astro:after-swap', shuffleFriends)
</script>
